<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Jet Reclustering by kratsg</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/kratsg/JetReclustering">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/kratsg/JetReclustering/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/kratsg/JetReclustering/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Jet Reclustering</h1>
          <p>Recluster Jets in a Single Bound!</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/kratsg">kratsg</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="xaod-jet-reclustering" class="anchor" href="#xaod-jet-reclustering" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>xAOD Jet Reclustering</h1>

<p>This tool allows you to recluster small-R xAOD jets into large-R xAOD jets. It provides configurable filtering of the small-R jets, reclustering using standard or variable-R algorithms, configurable trimming of the large-R jets, and jet moment &amp; jet substructure moment calculations.</p>

<p>If you would like to get involved, see the twiki for <a href="https://twiki.cern.ch/twiki/bin/view/AtlasProtected/JetReclustering">the JetMET working group for jet reclustering</a>. The <a href="https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/PreRec">pre-recommendations</a> twiki contains the guidelines for your analyses.</p>





<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc">DocToc</a></em></p>

<ul>
<li><a href="#installing">Installing</a></li>
<li>
<a href="#configurations-for">Configurations for</a>

<ul>
<li><a href="#jetreclusteringtool-tool"><code>JetReclusteringTool</code> tool</a></li>
<li><a href="#jetreclusteringalgo-algorithm"><code>JetReclusteringAlgo</code> algorithm</a></li>
<li><a href="#athjetreclusteringalgo-athena-algorithm"><code>AthJetReclusteringAlgo</code> Athena algorithm</a></li>
</ul>
</li>
<li>
<a href="#using-xaod-jet-reclustering">Using xAOD Jet Reclustering</a>

<ul>
<li><a href="#input-jet-filtering">Input Jet Filtering</a></li>
<li><a href="#output-reclustered-jet-trimming">Output Reclustered Jet Trimming</a></li>
<li><a href="#variable-r-jet-finding">Variable-R Jet Finding</a></li>
<li><a href="#area-calculations">Area Calculations</a></li>
<li>
<a href="#incorporating-in-existing-code">Incorporating in existing code</a>

<ul>
<li><a href="#rootcore">RootCore</a></li>
<li><a href="#athena">Athena</a></li>
</ul>
</li>
<li>
<a href="#incorporating-in-algorithm-chain">Incorporating in algorithm chain</a>

<ul>
<li><a href="#rootcore-1">RootCore</a></li>
<li><a href="#athena-1">Athena</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#studies-and-example-usage">Studies and Example Usage</a>

<ul>
<li><a href="#accessing-the-subjets-from-constituents">Accessing the subjets from constituents</a></li>
<li><a href="#accessing-various-jet-moments">Accessing various jet moments</a></li>
</ul>
</li>
<li><a href="#authors">Authors</a></li>
</ul>



<h2>
<a id="installing" class="anchor" href="#installing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installing</h2>

<p>This works in AB 2.3.X and 2.4.Y on ROOT6 releases. As long as <a href="http://acode-browser.usatlas.bnl.gov/lxr/source/atlas/Reconstruction/Jet/JetRec/JetRec/">JetRec</a> works, this will be ok.</p>

<div class="highlight highlight-source-shell"><pre>rcSetup Base,2.3.X <span class="pl-c"># or 2.4.Y</span>
git clone https://github.com/kratsg/xAODJetReclustering.git
rc find_packages
rc compile</pre></div>

<p><em>Warning</em>: use <code>X &gt;= 45</code> since I am using <code>ANA_CHECK</code> which only works with <code>EventLoop-00-01-35</code> or better.</p>

<h2>
<a id="configurations-for" class="anchor" href="#configurations-for" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configurations for</h2>

<h3>
<a id="jetreclusteringtool-tool" class="anchor" href="#jetreclusteringtool-tool" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JetReclusteringTool</code> tool</h3>

<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="center">Type</th>
<th align="right">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">InputJetContainer</td>
<td align="center">string</td>
<td align="right"></td>
<td align="left">name of the input jet container for reclustering</td>
</tr>
<tr>
<td align="left">OutputJetContainer</td>
<td align="center">string</td>
<td align="right"></td>
<td align="left">name of the output jet container holding reclustered jets</td>
</tr>
<tr>
<td align="left">InputJetPtMin</td>
<td align="center">float</td>
<td align="right">25.0</td>
<td align="left">filter input jets by requiring a minimum pt cut [GeV]</td>
</tr>
<tr>
<td align="left">ReclusterAlgorithm</td>
<td align="center">string</td>
<td align="right">AntiKt</td>
<td align="left">name of algorithm for clustering large-R jets {AntiKt, Kt, CamKt}</td>
</tr>
<tr>
<td align="left">ReclusterRadius</td>
<td align="center">float</td>
<td align="right">1.0</td>
<td align="left">radius of large-R reclustered jets or maximum radius of variable-R jet finding</td>
</tr>
<tr>
<td align="left">RCJetPtMin</td>
<td align="center">float</td>
<td align="right">50.0</td>
<td align="left">filter reclustered jets by requiring a minimum pt cut [GeV]</td>
</tr>
<tr>
<td align="left">RCJetPtFrac</td>
<td align="center">float</td>
<td align="right">0.05</td>
<td align="left">trim the reclustered jets with a PtFrac on its constituents (eg: small-R input jets)</td>
</tr>
<tr>
<td align="left">RCJetSubjetRadius</td>
<td align="center">float</td>
<td align="right">0.0</td>
<td align="left">radius parameter for kt-clustering to form subjets (R=0.0 should not do any clustering)</td>
</tr>
<tr>
<td align="left">VariableRMinRadius</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">minimum radius for variable-R jet finding</td>
</tr>
<tr>
<td align="left">VariableRMassScale</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">mass scale [GeV] for variable-R jet finding</td>
</tr>
<tr>
<td align="left">DoArea</td>
<td align="center">bool</td>
<td align="right">false</td>
<td align="left">turn on ghost area calculations (set ghost area scale to 0.01)</td>
</tr>
<tr>
<td align="left">AreaAttributes</td>
<td align="center">string</td>
<td align="right">ActiveArea ActiveArea4vec</td>
<td align="left">space-delimited list of attributes to transfer over from fastjet</td>
</tr>
</tbody>
</table>

<h3>
<a id="jetreclusteringalgo-algorithm" class="anchor" href="#jetreclusteringalgo-algorithm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JetReclusteringAlgo</code> algorithm</h3>

<p>As well as the provided above configurations for the <code>JetReclusteringTool</code>, we also provide a <code>m_debug</code> configuration for extra verbose output and an <code>m_outputXAODName</code> to create an output xAOD containing the reclustered jets (note: experimental)</p>

<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="center">Type</th>
<th align="right">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">m_inputJetContainer</td>
<td align="center">string</td>
<td align="right"></td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_outputJetContainer</td>
<td align="center">string</td>
<td align="right"></td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_ptMin_input</td>
<td align="center">float</td>
<td align="right">25.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_rc_alg</td>
<td align="center">string</td>
<td align="right">AntiKt</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_radius</td>
<td align="center">float</td>
<td align="right">1.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_ptMin_rc</td>
<td align="center">float</td>
<td align="right">50.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_ptFrac</td>
<td align="center">float</td>
<td align="right">0.05</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_subjet_radius</td>
<td align="center">float</td>
<td align="right">0.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_varR_minR</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_varR_mass</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_doArea</td>
<td align="center">bool</td>
<td align="right">false</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_areaAttributes</td>
<td align="center">string</td>
<td align="right">ActiveArea ActiveArea4vec</td>
<td align="left">see above</td>
</tr>
<tr>
<td align="left">m_outputXAODName</td>
<td align="center">string</td>
<td align="right"></td>
<td align="left">if defined, put the reclustered jets in an output xAOD file of the given name</td>
</tr>
<tr>
<td align="left">m_debug</td>
<td align="center">bool</td>
<td align="right">false</td>
<td align="left">enable verbose debugging information, such as printing the tool configurations</td>
</tr>
</tbody>
</table>

<h3>
<a id="athjetreclusteringalgo-athena-algorithm" class="anchor" href="#athjetreclusteringalgo-athena-algorithm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>AthJetReclusteringAlgo</code> Athena algorithm</h3>

<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="center">Type</th>
<th align="right">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">JetReclusteringTool</td>
<td align="center">ToolHandle</td>
<td align="right"></td>
<td align="left">The JetReclusteringTool to use. All configurables should be set on this.</td>
</tr>
</tbody>
</table>

<h2>
<a id="using-xaod-jet-reclustering" class="anchor" href="#using-xaod-jet-reclustering" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using xAOD Jet Reclustering</h2>

<h3>
<a id="input-jet-filtering" class="anchor" href="#input-jet-filtering" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Input Jet Filtering</h3>

<p>The input jets can be filtered using the <code>InputJetPtMin</code> or <code>m_ptMin_input</code> options. If these are set to 0 (or less), this will turn the jet filtering tool off (essentially skipping the step).</p>

<h3>
<a id="output-reclustered-jet-trimming" class="anchor" href="#output-reclustered-jet-trimming" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Output Reclustered Jet Trimming</h3>

<p>The output jets can be trimmed using the <code>RCJetPtFrac</code> or <code>m_ptFrac</code> options. If these are set to 0 (or less), this will turn the reclustered jet trimming tool off (essentially skipping the step). Note that by default, we will not kt-cluster the subjets as <code>RCJetSubjetRadius</code> / <code>m_subjet_radius</code> are set to 0.0 by default, however one can set them to a non-zero radius value if you want to form subjets (if you somehow passed in <code>xAOD::Jet</code> objects that represent clusters rather than small-R jets).</p>

<h3>
<a id="variable-r-jet-finding" class="anchor" href="#variable-r-jet-finding" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Variable-R Jet Finding</h3>

<p>Variable-R jet finding is performed if <code>VariableRMinRadius &gt;= 0</code> and <code>VariableRMassScale &gt;= 0</code>. For more information on these variables, see the <a href="http://arxiv.org/pdf/0903.0392v1.pdf">Jets with Variable R</a> paper. If you choose variable-R jet finding, the maximum jet radius will be specified by <code>ReclusterRadius</code>. The relevant properties are listed in the following table</p>

<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="center">Type</th>
<th align="right">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">ReclusterRadius</td>
<td align="center">float</td>
<td align="right">1.0</td>
<td align="left">maximum radius of variable-R jet finding</td>
</tr>
<tr>
<td align="left">VariableRMinRadius</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">minimum radius for variable-R jet finding</td>
</tr>
<tr>
<td align="left">VariableRMassScale</td>
<td align="center">float</td>
<td align="right">-1.0</td>
<td align="left">mass scale [GeV] for variable-R jet finding</td>
</tr>
</tbody>
</table>

<p>When a new jet is formed using variable-R jet finding, it will have some extra attributes as mentioned on the <a href="https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/Run2JetMoments">Run 2 - Jet Moments</a> twiki. We will also decorate with an <code>EffectiveR</code> attribute as well which reflects the effective radius of the reclustered jet using its untrimmed transverse momentum. To summarize the translations</p>

<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="center">Type</th>
<th>Jet Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">ReclusterRadius</td>
<td align="center">float</td>
<td>SizeParameter</td>
</tr>
<tr>
<td align="left">VariableRMinRadius</td>
<td align="center">float</td>
<td>VariableRMinRadius</td>
</tr>
<tr>
<td align="left">VariableRMassScale</td>
<td align="center">float</td>
<td>VariableRMassScale</td>
</tr>
<tr>
<td align="left"></td>
<td align="center">float</td>
<td>EffectiveR</td>
</tr>
</tbody>
</table>

<h3>
<a id="area-calculations" class="anchor" href="#area-calculations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Area Calculations</h3>

<p>Areas can be calculated and added to the jets. Fastjet does the area calculation and these values can be transferred over using the <code>JetFromPseudojet</code> tool. To make this happen, simply enable <code>m_doArea</code> (<code>DoArea</code>) which will set the ghost area size to <code>0.01</code> which is a reasonable default for most use cases. The attributes that get transferred over are defined in <code>m_areaAttributes</code> (<code>AreaAttributes</code>). As of the time of writing this section of the README, there were only two allowed values which would get decorated:</p>

<ul>
<li>
<code>ActiveArea</code> (most people use this one)</li>
<li><code>ActiveArea4vec</code></li>
</ul>

<h3>
<a id="incorporating-in-existing-code" class="anchor" href="#incorporating-in-existing-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Incorporating in existing code</h3>

<h4>
<a id="rootcore" class="anchor" href="#rootcore" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RootCore</h4>

<p>If you wish to incorporate <code>xAODJetReclustering</code> directly into your code, add this package as a dependency in <code>cmt/Makefile.RootCore</code> and then a header</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>AsgTools/AnaToolHandle.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>xAODJetReclustering/IJetReclusteringTool.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">class</span> <span class="pl-en">MyAlgo</span> : <span class="pl-k">public</span> <span class="pl-en">EL</span>::Algorithm {
  <span class="pl-c">// ...</span>

  asg::AnaToolHandle&lt;IJetReclusteringTool&gt; m_jetReclusteringTool; <span class="pl-c">//!</span>
}<span class="pl-ii"></span></pre></div>

<p>to get started. In the source, you need to add the tool header</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>xAODJetReclustering/JetReclusteringTool.h<span class="pl-pds">&gt;</span></span></pre></div>

<p>then make sure the AsgTool tool store sets up the tool correctly in the constructor</p>

<div class="highlight highlight-source-c++"><pre>MyAlgo :: MyAlgo () :
  <span class="pl-en">m_jetReclusteringTool</span>(<span class="pl-s"><span class="pl-pds">"</span>IJetReclusteringTool/ANameForTheTool<span class="pl-pds">"</span></span>)
  {}</pre></div>

<p>At this point, you can set up your standard tool in the <code>initialize()</code> portion of your algorithm as a tool handle</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-en">ANA_CHECK_SET_TYPE</span> (EL::StatusCode);
<span class="pl-en">ANA_CHECK</span>(ASG_MAKE_ANA_TOOL(m_jetReclusteringTool, JetReclusteringTool));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>InputJetContainer<span class="pl-pds">"</span></span>,  m_inputJetContainer));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>OutputJetContainer<span class="pl-pds">"</span></span>, m_outputJetContainer));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>ReclusterRadius<span class="pl-pds">"</span></span>,    m_radius));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>ReclusterAlgorithm<span class="pl-pds">"</span></span>, m_rc_alg));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>VariableRMinRadius<span class="pl-pds">"</span></span>, m_varR_minR));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>VariableRMassScale<span class="pl-pds">"</span></span>, m_varR_mass));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>InputJetPtMin<span class="pl-pds">"</span></span>,      m_ptMin_input));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>RCJetPtMin<span class="pl-pds">"</span></span>,         m_ptMin_rc));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>RCJetPtFrac<span class="pl-pds">"</span></span>,        m_ptFrac));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>RCJetSubjetRadius<span class="pl-pds">"</span></span>,  m_subjet_radius));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>DoArea<span class="pl-pds">"</span></span>,             m_doArea));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.setProperty(<span class="pl-s"><span class="pl-pds">"</span>AreaAttributes<span class="pl-pds">"</span></span>,     m_areaAttributes));
<span class="pl-en">ANA_CHECK</span>(m_jetReclusteringTool.retrieve());</pre></div>

<p>and then simply call <code>m_jetReclusteringTool-&gt;execute()</code> in the <code>execute()</code> portion of your algorithm to fill the TStore with the appropriate container(s). Note that you use a pointer on the second portion when calling <code>execute()</code> to access the underlying pointer to the tool itself. The functions <code>setProperty()</code> and <code>initialize()</code> have a return type <code>StatusCode</code> which needs to be checked.</p>

<h4>
<a id="athena" class="anchor" href="#athena" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Athena</h4>

<p>The methods for incorporating the code into an Athena algorithm are very similar to the method for RootCore.
The package must be included with a 'use' statement in <code>cmt/requirements</code>. Then in your header:</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>AsgTools/ToolHandle.h<span class="pl-pds">&gt;</span></span> <span class="pl-c">// Can use AnaToolHandle instead if you want</span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>xAODJetReclustering/IJetReclusteringTool.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">class</span> <span class="pl-en">MyAlgo</span> : public ::AthAnalysisAlgorithm { <span class="pl-c">// Or any of the other Athena algorithm types</span>
  <span class="pl-c">// ...</span>

  ToolHandle&lt;IJetReclusteringTool&gt; m_jetReclusteringTool;
};</pre></div>

<p>As with other Athena algorithms it's recommended to configure the tool in your job options and then pass it into your algorithm as a property. To do this, in the constructor you need to initialize the handle and declare it as a property</p>

<div class="highlight highlight-source-c++"><pre>
<span class="pl-en">MyAlgo::MyAlgo</span>( <span class="pl-k">const</span> std::string&amp; name, ISvcLocator* pSvcLocator )
: AthAnalysisAlgorithm( name, pSvcLocator ), <span class="pl-c">// Or other base class</span>
  m_jetReclusteringTool(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>) <span class="pl-c">// Can also initialize with a default type/name if you wish</span>
{
  <span class="pl-c">// Other properties...</span>
  <span class="pl-c1">declareProperty</span>( <span class="pl-s"><span class="pl-pds">"</span>JetReclusteringTool<span class="pl-pds">"</span></span>, m_jetReclusteringTool );
}</pre></div>

<p>Then in the <code>initialize()</code> member function of your algorithm <code>retrieve</code> the tool</p>

<div class="highlight highlight-source-c++"><pre>  <span class="pl-en">ATH_CHECK</span>( m_jetReclusteringTool.retrieve() );</pre></div>

<p>To use it in your algorithm you can call (in your <code>execute()</code> function). Make sure you do this <strong>before</strong> anyone tries to use the output...</p>

<div class="highlight highlight-source-c++"><pre>  <span class="pl-k">int</span> retCode = m_jetReclusteringTool-&gt;<span class="pl-en">execute</span>();
  <span class="pl-k">if</span> (retCode != <span class="pl-c1">0</span>) {
    <span class="pl-c1">ATH_MSG_ERROR</span>( <span class="pl-s"><span class="pl-pds">"</span>JetReclusteringTool failed in execution with code: <span class="pl-pds">"</span></span> &lt;&lt; retCode );
    <span class="pl-k">return</span> StatusCode::FAILURE;
  }</pre></div>

<p>Then you need to create and pass in your tool in your joboptions (see the section below for more instructions, replace <code>AthJetReclusteringAlgo</code> with <code>MyAlgo</code> or whatever you called your algorithm).
It is also possible to set the properties and initialize your tool in the cxx code but this isn't really recommended. If you want to do this either use AnaToolHandle and setProperty (analogously to in RootCore) or use ToolHandle and <a href="http://acode-browser2.usatlas.bnl.gov/lxr-AthAna/source/atlas/Control/AthAnalysisBaseComps/AthAnalysisBaseComps/AthAnalysisHelper.h#0053">AthAnalysisHelper</a>.</p>

<h3>
<a id="incorporating-in-algorithm-chain" class="anchor" href="#incorporating-in-algorithm-chain" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Incorporating in algorithm chain</h3>

<h4>
<a id="rootcore-1" class="anchor" href="#rootcore-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RootCore</h4>

<p>This is the least destructive option since it requires <strong>no change</strong> to your existing code. All you need to do is create a new <code>JetReclusteringAlgo</code> algorithm and add it to the job before other algorithms downstream that want access to the reclustered jets. It is highly configurable. In your runner macro, add the header</p>

<div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>xAODJetReclustering/JetReclusteringAlgo.h<span class="pl-pds">&gt;</span></span></pre></div>

<p>and then simply set up your algorithm like so</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-c">// initialize and set it up</span>
JetReclustering* jetReclusterer = <span class="pl-k">new</span> JetReclusteringAlgo();
jetReclusterer-&gt;m_inputJetContainer = <span class="pl-s"><span class="pl-pds">"</span>AntiKt4LCTopoJets<span class="pl-pds">"</span></span>;
jetReclusterer-&gt;m_outputJetContainer = <span class="pl-s"><span class="pl-pds">"</span>AntiKt10LCTopoJetsRCAntiKt4LCTopoJets<span class="pl-pds">"</span></span>;
jetReclusterer-&gt;m_name = <span class="pl-s"><span class="pl-pds">"</span>R10<span class="pl-pds">"</span></span>; <span class="pl-c">// unique name for the tool</span>
jetReclusterer-&gt;m_ptMin_input = <span class="pl-c1">25.0</span>; <span class="pl-c">// GeV</span>
jetReclusterer-&gt;m_ptMin_rc = <span class="pl-c1">50.0</span>; <span class="pl-c">// GeV</span>
jetReclusterer-&gt;m_ptFrac = <span class="pl-c1">0.05</span>; <span class="pl-c">// GeV</span>

<span class="pl-c">// ...</span>
<span class="pl-c">// ...</span>
<span class="pl-c">// ...</span>

<span class="pl-c">// add it to your job sometime later</span>
job.algsAdd(jetReclusterer);</pre></div>

<h4>
<a id="athena-1" class="anchor" href="#athena-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Athena</h4>

<p>As with RootCore this is the best way to use the tool (Athena is designed to execute a series of algorithms after all...).
All you need to do is create a <code>JetReclusteringTool</code> in the <code>ToolSvc</code>, add an <code>AthJetReclusteringAlgo</code> to your <code>AlgSequence</code> and connect them</p>

<div class="highlight highlight-source-python"><pre>ToolSvc <span class="pl-k">+=</span> CfgMgr.JetReclusteringTool(<span class="pl-s"><span class="pl-pds">"</span>MyJetReclusteringTool<span class="pl-pds">"</span></span>, <span class="pl-v">InputJetContainer</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>AntiKt4EMTopoJets<span class="pl-pds">"</span></span>, <span class="pl-v">OutputJetContainer</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>AntiKt10EMTopoJets_RC<span class="pl-pds">"</span></span>) <span class="pl-c"># Set up properties here</span>
ToolSvc.MyJetReclusteringTool.InputJetPtMin <span class="pl-k">=</span> <span class="pl-c1">10</span> <span class="pl-c">#Can also set properties like this </span>

algseq <span class="pl-k">=</span> CfgMgr.AthSequencer(<span class="pl-s"><span class="pl-pds">"</span>AthAlgSeq<span class="pl-pds">"</span></span>)                <span class="pl-c">#gets the main AthSequencer</span>
algseq <span class="pl-k">+=</span> CfgMgr.AthJetReclusteringAlgo(<span class="pl-s"><span class="pl-pds">"</span>JetRecAlgo<span class="pl-pds">"</span></span>, <span class="pl-v">JetReclusteringTool</span> <span class="pl-k">=</span> ToolSvc.MyJetReclusteringTool)</pre></div>

<p>Now any algorithm downstream of this in algseq will have access to the <code>AntiKt10EMPTopoJets_RC</code> container.
An example (and a test you can use) is in <code>share/AthJetReclusteringAlgoJobOptions.py</code></p>

<p>For now you will need to have checked out and compiled this package. If (when!) it makes it into the release you'll be able to use immediately once you've called asetup.</p>

<h2>
<a id="studies-and-example-usage" class="anchor" href="#studies-and-example-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Studies and Example Usage</h2>

<p>See <a href="https://github.com/kratsg/ReclusteringStudies">kratsg/ReclusteringStudies</a> for studies and example usage.</p>

<h3>
<a id="accessing-the-subjets-from-constituents" class="anchor" href="#accessing-the-subjets-from-constituents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing the subjets from constituents</h3>

<p>The reclustered jets have constituents which are your input small-R jets. These can be re-inflated, so to speak. As an example, I wanted to get the btagging information of my subjets as well as their constituents (eg: the topological calorimeter clusters, <code>TopoCaloClusters</code>)</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">for</span>(<span class="pl-k">auto</span> jet: *in_jets){
  <span class="pl-k">const</span> xAOD::Jet* <span class="pl-c1">subjet</span>(<span class="pl-v">nullptr</span>);
  <span class="pl-k">const</span> xAOD::BTagging* <span class="pl-c1">btag</span>(<span class="pl-v">nullptr</span>);
  <span class="pl-k">for</span>(<span class="pl-k">auto</span> constit: jet-&gt;<span class="pl-c1">getConstituents</span>()){
    subjet = <span class="pl-k">static_cast</span>&lt;<span class="pl-k">const</span> xAOD::Jet*&gt;(constit-&gt;<span class="pl-c1">rawConstituent</span>());
    btag = subjet-&gt;<span class="pl-c1">btagging</span>();
    <span class="pl-k">if</span>(btag)
      <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>btagging: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, btag-&gt;<span class="pl-c1">MV1_discriminant</span>());

    <span class="pl-k">for</span>(<span class="pl-k">auto</span> subjet_constit: subjet-&gt;<span class="pl-c1">getConstituents</span>())
      <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>constituent pt: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, subjet_constit-&gt;<span class="pl-c1">pt</span>());
  }
}</pre></div>

<p>where we explicitly <code>static_cast&lt;&gt;</code> our raw pointer from the <code>rawConstituent()</code> call. See <a href="http://acode-browser.usatlas.bnl.gov/lxr/source/atlas/Event/xAOD/xAODJet/xAODJet/JetConstituentVector.h">xAODJet/JetConstituentVector.h</a> for more information about what is available. As a raw pointer, we already know that the input to the constituents were small-R jets (since we re-clustered ourselves) so this type of casting is safe.</p>

<h3>
<a id="accessing-various-jet-moments" class="anchor" href="#accessing-various-jet-moments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing various jet moments</h3>

<p>We try to use the standard <code>JetModifier</code> tools that are available ATLAS-wide. In those cases, you can find a lot more information on the <a href="https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/Run2JetMoments">Run 2 - Jet Moments</a> twiki. There are two ways to figure out what information is stored on the reclustered jet.</p>

<ol>
<li>Store the reclustered jets in an output xAOD. Use <a href="https://github.com/kratsg/xAODDumper">kratsg/xAODDumper</a> to dump the properties and attributes of the jet containers associated with the reclustered jets.</li>
<li>Go to <a href="Root/JetReclusteringTool.cxx#L101">Root/JetReclusteringTool.cxx</a> around line 100, find the <code>modArray.push_back()</code> calls, and look at all the tools being added. For a given tool, you can look it up in the <a href="https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/Run2JetMoments">Run 2 - Jet Moments</a> twiki to figure out the corresponding property names.</li>
</ol>

<p>As an example of the second way, I see that <code>m_ktSplittingScaleTool</code> is added. On the twiki, I see an entry for <code>KTSplittingScaleTool</code> which lists 6 variables associated with it: <code>Split12, Split23, Split34, ZCut12, ZCut23, ZCut34</code> and all are of a <code>float</code> type, so I can write</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">Split12</span>(<span class="pl-s"><span class="pl-pds">"</span>Split12<span class="pl-pds">"</span></span>);
<span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">Split23</span>(<span class="pl-s"><span class="pl-pds">"</span>Split23<span class="pl-pds">"</span></span>);
<span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">Split34</span>(<span class="pl-s"><span class="pl-pds">"</span>Split34<span class="pl-pds">"</span></span>);
<span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">ZCut12</span>(<span class="pl-s"><span class="pl-pds">"</span>ZCut12<span class="pl-pds">"</span></span>);
<span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">ZCut23</span>(<span class="pl-s"><span class="pl-pds">"</span>ZCut23<span class="pl-pds">"</span></span>);
<span class="pl-k">static</span> SG::AuxElement::ConstAccessor&lt;<span class="pl-k">float</span>&gt; <span class="pl-en">ZCut34</span>(<span class="pl-s"><span class="pl-pds">"</span>ZCut34<span class="pl-pds">"</span></span>);</pre></div>

<p>and with these, I can quickly access it on my jet (protecting myself against when it doesn't exist for some reason)</p>

<div class="highlight highlight-source-c++"><pre><span class="pl-k">for</span>(<span class="pl-k">auto</span> jet: *in_jets){
  <span class="pl-k">if</span>(Split12.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Split12: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">Split12</span>(*jet));
  <span class="pl-k">if</span>(Split23.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Split23: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">Split23</span>(*jet));
  <span class="pl-k">if</span>(Split34.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Split34: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">Split34</span>(*jet));
  <span class="pl-k">if</span>(ZCut12.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>ZCut12: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">ZCut12</span>(*jet));
  <span class="pl-k">if</span>(ZCut23.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>ZCut23: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">ZCut23</span>(*jet));
  <span class="pl-k">if</span>(ZCut34.<span class="pl-c1">isAvailable</span>(*jet))
    <span class="pl-c1">Info</span>(<span class="pl-s"><span class="pl-pds">"</span>execute()<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span>ZCut34: <span class="pl-c1">%0.2f</span><span class="pl-pds">"</span></span>, <span class="pl-c1">ZCut34</span>(*jet));
}
</pre></div>

<h2>
<a id="authors" class="anchor" href="#authors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authors</h2>

<ul>
<li><a href="https://github.com/kratsg">Giordon Stark</a></li>
<li><a href="https://github.com/j0nburr">Jon Burr</a></li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-56943050-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
